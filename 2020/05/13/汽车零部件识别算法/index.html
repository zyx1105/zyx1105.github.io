<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zyx1105.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="背景  人工分拣耗时耗力，且分拣正确率不高（60-70%） 人工智能领域正在快速发展，其中应用于识别分类方向的深度学习为重点研究方向  技术路线  基于** TensorFlow 框架，实现零件的识别**。  TensorFlow是一个基于数据流编程的符号数学系统，被广泛应 用于各类机器学习算法的编程实现。   本算法由五个部分组成：数据增强、图片标注、训练模型、测试模型、预测模型。数据增强用于对">
<meta property="og:type" content="article">
<meta property="og:title" content="汽车零部件识别算法">
<meta property="og:url" content="https://zyx1105.github.io/2020/05/13/%E6%B1%BD%E8%BD%A6%E9%9B%B6%E9%83%A8%E4%BB%B6%E8%AF%86%E5%88%AB%E7%AE%97%E6%B3%95/index.html">
<meta property="og:site_name" content="Welcome to my Blog-Zzzzzz">
<meta property="og:description" content="背景  人工分拣耗时耗力，且分拣正确率不高（60-70%） 人工智能领域正在快速发展，其中应用于识别分类方向的深度学习为重点研究方向  技术路线  基于** TensorFlow 框架，实现零件的识别**。  TensorFlow是一个基于数据流编程的符号数学系统，被广泛应 用于各类机器学习算法的编程实现。   本算法由五个部分组成：数据增强、图片标注、训练模型、测试模型、预测模型。数据增强用于对">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513002431589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513002554562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513003029556.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513003457866.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513003605274.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513080632726.png#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513081054326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513082323540.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200513082614237.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="article:published_time" content="2020-05-13T00:34:10.738Z">
<meta property="article:modified_time" content="2020-05-13T00:33:47.494Z">
<meta property="article:author" content="Zyx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200513002431589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center">

<link rel="canonical" href="https://zyx1105.github.io/2020/05/13/%E6%B1%BD%E8%BD%A6%E9%9B%B6%E9%83%A8%E4%BB%B6%E8%AF%86%E5%88%AB%E7%AE%97%E6%B3%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>汽车零部件识别算法 | Welcome to my Blog-Zzzzzz</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Welcome to my Blog-Zzzzzz</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zyx1105.github.io/2020/05/13/%E6%B1%BD%E8%BD%A6%E9%9B%B6%E9%83%A8%E4%BB%B6%E8%AF%86%E5%88%AB%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zyx">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Welcome to my Blog-Zzzzzz">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          汽车零部件识别算法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-13 08:34:10 / Modified: 08:33:47" itemprop="dateCreated datePublished" datetime="2020-05-13T08:34:10+08:00">2020-05-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>背景</p>
<ul>
<li>人工分拣耗时耗力，且分拣正确率不高（60-70%）</li>
<li>人工智能领域正在快速发展，其中应用于识别分类方向的深度学习为重点研究方向</li>
</ul>
<h2 id="技术路线"><a href="#技术路线" class="headerlink" title="技术路线"></a>技术路线</h2><p>  基于** TensorFlow 框架，实现零件的识别**。<br>  TensorFlow是一个基于数据流编程的符号数学系统，被广泛应 用于各类机器学习算法的编程实现。   本算法由五个部分组成：数据增强、图片标注、训练模型、测试模型、预测模型。数据增强用于对原始收集的图像进行数据扩增，解决初始数据量不足的问题；图片标注，为将各类图片以其特定的文件命名格式进行命名，有利于后期的训练；训练模型，为该算法的核心程序，通过搭建卷积神经网络，进行训练，从而获得最优参数模型；测试模式：通过训练模式所获得的最优参数解，来进行测试集的预测，从而获得正确率，进一步确定训练的效果；预测模型：将未知的图片输入到训练完成的最优参数模型中，从而获得相应的类别。</p>
<h2 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h2><p>tensorflow  1.5.0</p>
<p>CUDA  9.0.176</p>
<p>CUDNN  7</p>
<p>操作系统：Linux ubuntu 16.04</p>
<p>集成开发、调试及编译环境：pycharm-community-2019.2.1</p>
<h2 id="系统总体结构"><a href="#系统总体结构" class="headerlink" title="系统总体结构"></a>系统总体结构</h2><p>该算法基于<strong>TensorFlow</strong>框架，实现零件的识别。<br>TensorFlow是一个基于数据流编程的符号数学系统，被广泛应用于各类机器学习算法的编程实现。<br>本算法由五个部分组成：数据增强、图片标注、训练模型、测试模型、预测模型。</p>
<ul>
<li>数据增强用于对原始收集的图像进行数据扩增，解决初始数据量不足的问题；</li>
<li>图片标注，为将各类图片以其特定的文件命名格式进行命名，有利于后期的训练；</li>
<li>训练模型，为该算法的核心程序，通过搭建卷积神经网络，进行训练，从而获得最优参数模型；</li>
<li>测试模式：通过训练模式所获得的最优参数解，来进行测试集的预测，从而获得正确率，进一步确定训练的效果；</li>
<li>预测模型：将未知的图片输入到训练完成的最优参数模型中，从而获得相应的类别。<img src="https://img-blog.csdnimg.cn/20200513002431589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="整体设计"></li>
</ul>
<h2 id="数据增强"><a href="#数据增强" class="headerlink" title="数据增强"></a>数据增强</h2><p><img src="https://img-blog.csdnimg.cn/20200513002554562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>  <strong>增强训练数据，就能够提升算法的准确率，因为这样可以避免过拟合，更好地泛化。</strong>主要调用opencv库中的图像处理函数进行按照比例的随机选择图像处理方法，从而对图像进行扩增，其中，图像处理方法，分为几何变换，颜色变换，对比度和亮度变化，加入噪音和图像模糊处理。其中几何变换由分为：随机改变图像的大小，随机进行缩放，旋转，翻转；从原始图像随机裁剪部分图片；图片的水平和竖直翻转。加入噪声主要是对主成分做一个（0，0.1）的高斯扰动。颜色变换为将RGB三个通道的分量大小按照比例进行缩放。对比度和亮度变化为给图片碎甲加一些光照，如锐化，凸点，自适应直方图均衡化等。图像模糊处理分为三个部分：普通模糊，一般模糊和非常模糊处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">sometimes = <span class="keyword">lambda</span> aug: iaa.Sometimes(<span class="number">0.5</span>,</span><br><span class="line">aug)</span><br><span class="line">seq = iaa.Sequential([</span><br><span class="line">iaa.SomeOf((<span class="number">0</span>, <span class="number">5</span>),</span><br><span class="line">               [</span><br><span class="line">                   iaa.Fliplr(<span class="number">0.5</span>), </span><br><span class="line">                   iaa.Flipud(<span class="number">0.5</span>), </span><br><span class="line">                   sometimes(</span><br><span class="line">                      iaa.Superpixels(</span><br><span class="line">                          p_replace=(<span class="number">0</span>, <span class="number">1.0</span>)</span><br><span class="line">                           n_segments=(<span class="number">20</span>, <span class="number">200</span>)</span><br><span class="line">                       )</span><br><span class="line">                   ),</span><br><span class="line">                  iaa.OneOf([</span><br><span class="line">                       iaa.GaussianBlur((<span class="number">0</span>,<span class="number">3.0</span>)),</span><br><span class="line">                       iaa.AverageBlur(k=(<span class="number">2</span>, <span class="number">7</span>)),</span><br><span class="line">                      iaa.MedianBlur(k=(<span class="number">3</span>,<span class="number">11</span>)),</span><br><span class="line">                   ])，</span><br><span class="line">                   iaa.Sharpen(alpha=(<span class="number">0</span>, <span class="number">1.0</span>),</span><br><span class="line">lightness=(<span class="number">0.75</span>, <span class="number">1.5</span>)),</span><br><span class="line"></span><br><span class="line">                   iaa.Emboss(alpha=(<span class="number">0</span>, <span class="number">1.0</span>),</span><br><span class="line">strength=(<span class="number">0</span>, <span class="number">2.0</span>)),</span><br><span class="line">                   iaa.AdditiveGaussianNoise(</span><br><span class="line">                       loc=<span class="number">0</span>, scale=(<span class="number">0.0</span>, <span class="number">0.05</span></span><br><span class="line">* <span class="number">255</span>)</span><br><span class="line">                   ),</span><br><span class="line">                   iaa.Invert(<span class="number">0.05</span>,</span><br><span class="line">per_channel=<span class="literal">True</span>),  <span class="comment"># invert color</span></span><br><span class="line">channels</span><br><span class="line">                   iaa.AddElementwise((<span class="number">-40</span>,</span><br><span class="line"><span class="number">40</span>)),</span><br><span class="line">                  iaa.Multiply((<span class="number">0.5</span>, <span class="number">1.5</span>)),                  </span><br><span class="line">iaa.MultiplyElementwise((<span class="number">0.5</span>, <span class="number">1.5</span>)),                  </span><br><span class="line">iaa.ContrastNormalization((<span class="number">0.5</span>, <span class="number">2.0</span>)),</span><br><span class="line">               ],</span><br><span class="line">               random_order=<span class="literal">True</span>               )</span><br><span class="line">], random_order=<span class="literal">True</span>)</span><br><span class="line">path = <span class="string">'/home/ubuntu/coding/test/windshield_wiper/'</span></span><br><span class="line">imglist = []</span><br><span class="line">folderlist = os.listdir(path)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> folderlist:   </span><br><span class="line">path1=os.path.join(path,item)</span><br><span class="line">img = cv2.imread(path1)</span><br><span class="line">print(<span class="string">'item is '</span>,item)</span><br><span class="line">print(<span class="string">'img is '</span>,img)</span><br><span class="line"><span class="comment">#images = load_batch(batch_idx)</span></span><br><span class="line">imglist.append(img)</span><br><span class="line">print(<span class="string">'imglist is '</span> ,imglist)</span><br><span class="line"><span class="comment">#print("the length of imglist" +</span></span><br><span class="line">len(imglist))</span><br><span class="line">print(<span class="string">'all the picture have been appent to</span></span><br><span class="line"><span class="string">imglist'</span>)</span><br><span class="line"><span class="keyword">for</span> count <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">images_aug = seq.augment_images(imglist)</span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(len(images_aug)):</span><br><span class="line">filename = str(count) + str(index) + <span class="string">'.jpg'</span></span><br><span class="line">cv2.imwrite(path + filename, images_aug[index])</span><br><span class="line">print(<span class="string">'image of count%s index%s has been writen'</span> % (count, index))</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200513003029556.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="数据增强效果图"></p>
<h2 id="图片标注"><a href="#图片标注" class="headerlink" title="图片标注"></a>图片标注</h2><p>为了利于后期的训练，故要将图片的名字按照label_id.jpg的格式进行重命名。其中，label为每一类的标签，其对应关系如表1所示，id为图片的序号，每一张图片有自己的单独的序号。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rename</span><span class="params">(rename_path, outer_path,</span></span></span><br><span class="line"><span class="function"><span class="params">folderlist)</span>:</span><span class="comment"># 列举文件夹   </span></span><br><span class="line"><span class="keyword">for</span> folder <span class="keyword">in</span> folderlist:       </span><br><span class="line"><span class="keyword">if</span> os.path.basename(folder) == <span class="string">'doorknod'</span>:            </span><br><span class="line">foldnum = <span class="number">0</span>       </span><br><span class="line"><span class="keyword">elif</span> os.path.basename(folder) == <span class="string">'rearview_mirrow'</span>:           </span><br><span class="line">foldnum = <span class="number">1</span>       </span><br><span class="line"><span class="keyword">elif</span> os.path.basename(folder) == <span class="string">'steering_wheel'</span>:           </span><br><span class="line">foldnum = <span class="number">2</span>       </span><br><span class="line"><span class="keyword">elif</span> os.path.basename(folder) == <span class="string">'wheel'</span>:           </span><br><span class="line">foldnum = <span class="number">3</span>      </span><br><span class="line"><span class="keyword">elif</span> os.path.basename(folder) == <span class="string">'windshield_wiper'</span>:           </span><br><span class="line">foldnum = <span class="number">4</span>       </span><br><span class="line">inner_path = os.path.join(outer_path, folder)       </span><br><span class="line">total_num_folder = len(folderlist) </span><br><span class="line"><span class="comment"># 文件夹的总数       </span></span><br><span class="line"><span class="comment"># print 'total have %d folders' % (total_num_folder)   #打印文件夹的总数      </span></span><br><span class="line">filelist = os.listdir(inner_path) </span><br><span class="line"><span class="comment"># 列举图片       </span></span><br><span class="line">i = <span class="number">0</span>      </span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> filelist:          </span><br><span class="line">total_num_file = len(filelist)  <span class="comment"># 单个文件夹内图片的总数           </span></span><br><span class="line"><span class="keyword">if</span> item.endswith(<span class="string">'.jpg'</span>):<span class="comment">#endwith </span></span><br><span class="line">判断字符串是不是以“.jpg<span class="string">"结尾  字符串匹配</span></span><br><span class="line"><span class="string">                src =</span></span><br><span class="line"><span class="string">os.path.join(os.path.abspath(inner_path), item) </span></span><br><span class="line"><span class="string"># 原图的地址</span></span><br><span class="line"><span class="string">                #os.path.abspath(_file_):  获得当前脚本的完整路径</span></span><br><span class="line"><span class="string">                dst =</span></span><br><span class="line"><span class="string">os.path.join(os.path.abspath(rename_path), str(foldnum) + '_' + str(</span></span><br><span class="line"><span class="string">i)                +'.jpg')</span></span><br><span class="line"><span class="string"> try:</span></span><br><span class="line"><span class="string">                os.rename(src, dst)</span></span><br><span class="line"><span class="string">                print 'converting %s to %s ...'</span></span><br><span class="line"><span class="string">% (src, dst)</span></span><br><span class="line"><span class="string">                i += 1</span></span><br><span class="line"><span class="string"> except:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                continue</span></span><br><span class="line"><span class="string">rename_path1 =</span></span><br><span class="line"><span class="string">'/home/ubuntu/coding/renametrain'</span></span><br><span class="line"><span class="string">outer_path1 = '/home/ubuntu/coding/train'</span></span><br><span class="line"><span class="string">folderlist1 =</span></span><br><span class="line"><span class="string">os.listdir("</span>/home/ubuntu/coding/train<span class="string">")</span></span><br><span class="line"><span class="string">rename(rename_path1, outer_path1,</span></span><br><span class="line"><span class="string">folderlist1)</span></span><br><span class="line"><span class="string">print("</span>train totally rename ! !</span><br><span class="line">!<span class="string">")</span></span><br><span class="line"><span class="string">rename_path2 =</span></span><br><span class="line"><span class="string">'/home/ubuntu/coding/renametest'</span></span><br><span class="line"><span class="string">outer_path2 = '/home/ubuntu/coding/test'</span></span><br><span class="line"><span class="string">folderlist2 =</span></span><br><span class="line"><span class="string">os.listdir('/home/ubuntu/coding/test')</span></span><br><span class="line"><span class="string">rename(rename_path2, outer_path2,</span></span><br><span class="line"><span class="string">folderlist2)</span></span><br><span class="line"><span class="string">print("</span>test totally rename ! ! !<span class="string">")</span></span><br><span class="line"><span class="string">def convertjpg(jpgfile, outdir, width=258,</span></span><br><span class="line"><span class="string">height=258): # 修改图片尺寸   </span></span><br><span class="line"><span class="string">img = Image.open(jpgfile)   </span></span><br><span class="line"><span class="string">img = img.convert('RGB')   </span></span><br><span class="line"><span class="string">img.save(os.path.join(outdir, os.path.basename(jpgfile)))  </span></span><br><span class="line"><span class="string">new_img = img.resize((width, height), Image.BILINEAR)   </span></span><br><span class="line"><span class="string">new_img.save(os.path.join(outdir, os.path.basename(jpgfile)))</span></span><br><span class="line"><span class="string">for jpgfile in</span></span><br><span class="line"><span class="string">glob.glob("</span>/home/ubuntu/coding/renametrain/*.jpg<span class="string">"):   </span></span><br><span class="line"><span class="string">convertjpg(jpgfile, "</span>/home/ubuntu/coding/data<span class="string">")</span></span><br><span class="line"><span class="string">print("</span>train totally resize ! !</span><br><span class="line">!<span class="string">")</span></span><br><span class="line"><span class="string">for jpgfile in</span></span><br><span class="line"><span class="string">glob.glob("</span>/home/ubuntu/coding/renametest/*.jpg<span class="string">"):  </span></span><br><span class="line"><span class="string">convertjpg(jpgfile, "</span>/home/ubuntu/coding/val<span class="string">")</span></span><br><span class="line"><span class="string">print("</span>test totally</span><br><span class="line">resize ! ! !<span class="string">")</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200513003457866.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="图片标注"></p>
<h2 id="训练模型"><a href="#训练模型" class="headerlink" title="训练模型"></a>训练模型</h2><p><img src="https://img-blog.csdnimg.cn/20200513003605274.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="训练模型"></p>
<ul>
<li><p>CNN：与普通的神经网络相似，具有可学习的权重和偏置常数的神经元组成，每个神经元都接受一些输入，并做一些点积计算，然后算出对应的分类的概率，从而选择出为哪一个类别。</p>
</li>
<li><p>过拟合：在样本数目过小导致训练出来的模型在训练集的准确度达到接近1，导致过于贴合训练集的特征，无法对未知的图片进行很好的分辨，泛化能力弱</p>
</li>
<li><p>损失函数用于没描述模型和真实值之间的差距大小，本算法选取了交叉熵的损失计算方式(熵是信息量的加权平均数，熵越小，则对应的不确定性越小CEH（p,q）=-∑p(x)logq(x)<br>p:真实样本分布，q 待估计的模型)</p>
</li>
<li><p>激活函数：可以使得梯度下降的算法运行的更快。</p>
</li>
<li><p>梯度下降：数据不断找到最优解的过程，（学习率）数据迭代的快慢。这个学习率不可以过大，也不可以过小，过大可能会导致无法达到最优解，导致梯度爆炸，过小可以能会导致迭代速率太慢</p>
</li>
<li><p>梯度爆炸：初始层的权值过大，导致前面层比后面曾变化更快，导致权值越来越大，从而产生梯度爆炸<br>发生连乘后会导致权值越来越大，从而导致梯度爆炸=&gt;减小模型层数，或者改用relu，权重大幅更新。</p>
</li>
<li><p>梯度消失：反向传播的时候，最后一层的导数几乎为0，根据链式规则，那么最后一层的值几乎为0。=&gt;增大学习率，加深层数。</p>
</li>
<li><p>[2.2]最大池化层就是将输入按照[2,2]分开，选取最大的一个值，缩减模型的大小，提高计算速度，同时提高算法的鲁棒性，保留最明显的特征。</p>
</li>
<li><p>全连接层可以理解为将最后的输出矩阵全部变成一列，然后再经过softmax的计算得出</p>
</li>
<li><p>softmax:输出=e^x1/∑e^xi 从而得到概率最大的一类，作为预测结果。</p>
</li>
<li><p>dropout:被丢弃的比例，如果将所有的特征都计算进去，对电脑的计算能力有较大的要求，所以设置随机抛弃部分特征值，优化计算。</p>
</li>
<li><p>batch：如果一次将所有的图片都放进去会导致占用过多内存，对电脑算例要求过高，所以采取一次随机挑选batch的图片进行预测。</p>
</li>
<li><p>可调整的参数为：迭代次数，dropout,batch等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">datas_placeholder = tf.placeholder(tf.float32, [<span class="literal">None</span>, <span class="number">258</span>, <span class="number">258</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">labels_placeholder = tf.placeholder(tf.int32, [<span class="literal">None</span>])</span><br><span class="line"></span><br><span class="line">dropout_placeholdr = tf.placeholder(tf.float32) <span class="comment"># 存放DropOut参数的容器，训练时为0.25，测试时为0</span></span><br><span class="line"></span><br><span class="line">conv0 = tf.layers.conv2d(datas_placeholder,<span class="number">10</span>,<span class="number">5</span>,padding</span><br><span class="line">=<span class="string">'same'</span>,activation=tf.nn.relu); <span class="comment">#定义卷积层，20个卷积核，卷积核大小为5，用Relu激活</span></span><br><span class="line"></span><br><span class="line">pool0 = tf.layers.max_pooling2d(conv0,[<span class="number">2</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">conv1 = tf.layers.conv2d(pool0,<span class="number">20</span>,<span class="number">5</span>,padding =</span><br><span class="line"><span class="string">'same'</span>,activation=tf.nn.relu);</span><br><span class="line"></span><br><span class="line">pool1 = tf.layers.max_pooling2d(conv1,[<span class="number">2</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">conv2 = tf.layers.conv2d(pool1, <span class="number">40</span>, <span class="number">5</span>, activation=tf.nn.relu) <span class="comment"># 定义卷积层, 20个卷积核, 卷积核大小为5，用Relu激活</span></span><br><span class="line"></span><br><span class="line">pool2 = tf.layers.max_pooling2d(conv2, [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">2</span>]) <span class="comment"># 定义max-pooling层，pooling窗口为2x2，步长为2x2</span></span><br><span class="line"></span><br><span class="line">conv3 = tf.layers.conv2d(pool2, <span class="number">60</span>, <span class="number">5</span>, activation=tf.nn.relu) <span class="comment"># 定义卷积层, 40个卷积核, 卷积核大小为4，用Relu激活</span></span><br><span class="line"></span><br><span class="line">pool3 = tf.layers.max_pooling2d(conv3, [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">2</span>]) <span class="comment"># 定义max-pooling层，pooling窗口为2x2，步长为2x2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#conv4 = tf.layers.conv2d(pool3, 60, 3, activation=tf.nn.relu) # 定义卷积层, 60个卷积核, 卷积核大小为3，用Relu激活</span></span><br><span class="line"></span><br><span class="line">flatten = tf.layers.flatten(pool3)</span><br><span class="line"></span><br><span class="line">fc1 = tf.layers.dense(flatten, <span class="number">1000</span>, activation=tf.nn.relu)</span><br><span class="line"></span><br><span class="line">fc2 = tf.layers.dense(fc1,<span class="number">100</span>,activation= tf.nn.relu)</span><br><span class="line"></span><br><span class="line">dropout_fc = tf.layers.dropout(fc2, dropout_placeholdr)</span><br><span class="line"></span><br><span class="line">logits = tf.layers.dense(dropout_fc, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">predicted_labels = tf.arg_max(logits, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">losses = tf.nn.softmax_cross_entropy_with_logits(</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">labels=tf.one_hot(labels_placeholder, <span class="number">5</span>),</span><br><span class="line"></span><br><span class="line">    logits=logits</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">mean_loss = tf.reduce_mean(losses)</span><br><span class="line"></span><br><span class="line">optimizer = tf.train.AdamOptimizer(learning_rate=<span class="number">1e-3</span>).minimize(losses)</span><br><span class="line"></span><br><span class="line">n = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">saver = tf.train.Saver()<span class="comment"># 用于保存和载入模型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> train:</span><br><span class="line"></span><br><span class="line">        t1 = time.time()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"训练模式"</span>)</span><br><span class="line"></span><br><span class="line">               sess.run(tf.global_variables_initializer())</span><br><span class="line"></span><br><span class="line">        x = []</span><br><span class="line"></span><br><span class="line">        y = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">15000</span>):</span><br><span class="line"></span><br><span class="line">          pathDir =</span><br><span class="line">os.listdir(data_dir)  <span class="comment"># 取图片的原始路径</span></span><br><span class="line"></span><br><span class="line">          filenumber =</span><br><span class="line">len(pathDir)</span><br><span class="line"></span><br><span class="line">          rate = <span class="number">0.03</span>  <span class="comment"># 自定义抽取图片的比例，比方说100张抽10张，那就是0.1</span></span><br><span class="line"></span><br><span class="line">          picknumber = int(filenumber</span><br><span class="line">* rate)  <span class="comment"># 按照rate比例从文件夹中取一定数量图片</span></span><br><span class="line"></span><br><span class="line">          sample =</span><br><span class="line">random.sample(pathDir, picknumber)  <span class="comment"># 随机选取picknumber数量的样本图片</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">#print (sample)</span></span><br><span class="line"></span><br><span class="line">         </span><br><span class="line">os.mkdir(<span class="string">'/home/ubuntu/coding/batch'</span>)</span><br><span class="line"></span><br><span class="line">         </span><br><span class="line">tarDir=<span class="string">'/home/ubuntu/coding/batch'</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> name <span class="keyword">in</span> sample:</span><br><span class="line"></span><br><span class="line">              origin_dir =</span><br><span class="line">os.path.join(data_dir,name)</span><br><span class="line"></span><br><span class="line">              tar_dir</span><br><span class="line">=os.path.join(tarDir,name)</span><br><span class="line"></span><br><span class="line">             </span><br><span class="line">shutil.copy(origin_dir, tar_dir)</span><br><span class="line"></span><br><span class="line">          fpaths, datas, labels =</span><br><span class="line">read_data(tarDir)</span><br><span class="line"></span><br><span class="line">          train_feed_dict = &#123;</span><br><span class="line"></span><br><span class="line">              datas_placeholder: datas,</span><br><span class="line"></span><br><span class="line">              labels_placeholder:</span><br><span class="line">labels,</span><br><span class="line"></span><br><span class="line">              dropout_placeholdr:</span><br><span class="line"><span class="number">0.25</span></span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          _, mean_loss_val =</span><br><span class="line">sess.run([optimizer, mean_loss], feed_dict=train_ feed_  dict)</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> step % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">            print(<span class="string">"step = &#123;&#125;\tmean loss =</span></span><br><span class="line"><span class="string">&#123;&#125;"</span>.format(step, mean_loss_val))</span><br><span class="line"></span><br><span class="line">            x.append(step)</span><br><span class="line"></span><br><span class="line">           </span><br><span class="line">y.append(mean_loss_val)</span><br><span class="line"></span><br><span class="line">          shutil.rmtree(tarDir)</span><br><span class="line"></span><br><span class="line">        saver.save(sess,</span><br><span class="line">model_path)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"训练结束，保存模型到&#123;&#125;"</span>.format(model_path))</span><br></pre></td></tr></table></figure>
<p>运行结果<br>生成对应的参数模型<br><img src="https://img-blog.csdnimg.cn/20200513080632726.png#pic_center" alt="运行效果"><br><img src="https://img-blog.csdnimg.cn/20200513081054326.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="损失函数"></p>
<h2 id="测试模型"><a href="#测试模型" class="headerlink" title="测试模型"></a>测试模型</h2><p>交叉测验：利用之前收集的数据集进行7：3划分，7用来测试，3的部分进行测验，参数用训练模型得到的参数。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">saver.restore(sess, model_path)</span><br><span class="line">        print(<span class="string">"从&#123;&#125;载入模型"</span>.format(model_path))</span><br><span class="line">        <span class="comment"># label和名称的对照关系</span></span><br><span class="line">        label_name_dict = &#123;</span><br><span class="line">            <span class="number">0</span>:</span><br><span class="line"><span class="string">"doorknod"</span>,</span><br><span class="line">            <span class="number">1</span>:</span><br><span class="line"><span class="string">"rearview_mirrow"</span>,</span><br><span class="line">            <span class="number">2</span>:</span><br><span class="line"><span class="string">"steering_wheel"</span>,</span><br><span class="line">            <span class="number">3</span>: <span class="string">"wheel"</span>,</span><br><span class="line">            <span class="number">4</span>:</span><br><span class="line"><span class="string">"windshield_wiper"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        correct_average = <span class="number">0</span></span><br><span class="line">        x=[]</span><br><span class="line">        y=[]</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">            correct_rate=<span class="number">0.00</span></span><br><span class="line">            pathDir =</span><br><span class="line">os.listdir(data_dir)  <span class="comment"># 取图片的原始路径</span></span><br><span class="line">            filenumber =</span><br><span class="line">len(pathDir)</span><br><span class="line">            rate = <span class="number">0.1</span>  <span class="comment"># 自定义抽取图片的比例，比方说100张抽10张，那就是0.1</span></span><br><span class="line">            picknumber = int(filenumber * rate)  <span class="comment"># 按照rate比例从文件夹中取一定数量图片</span></span><br><span class="line">            sample =</span><br><span class="line">random.sample(pathDir, picknumber)  <span class="comment"># 随机选取picknumber数量的样本图片</span></span><br><span class="line">            <span class="comment"># print (sample)</span></span><br><span class="line">os.mkdir(<span class="string">'/home/ubuntu/coding/batch'</span>)</span><br><span class="line">            tarDir = <span class="string">'/home/ubuntu/coding/batch'</span></span><br><span class="line">            <span class="keyword">for</span> name <span class="keyword">in</span> sample:</span><br><span class="line">                origin_dir =</span><br><span class="line">os.path.join(data_dir, name)</span><br><span class="line">                tar_dir =</span><br><span class="line">os.path.join(tarDir, name)</span><br><span class="line">               </span><br><span class="line">shutil.copy(origin_dir, tar_dir)</span><br><span class="line">            fpaths, datas, labels</span><br><span class="line">= read_data(tarDir）</span><br><span class="line">        <span class="comment">#fpaths, datas, labels =</span></span><br><span class="line">read_data(data_dir)</span><br><span class="line">            test_feed_dict = &#123;</span><br><span class="line">                datas_placeholder:</span><br><span class="line">datas,          </span><br><span class="line">label_placeholder: labels,               </span><br><span class="line">dropout_placeholdr: <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">            predicted_labels_val =</span><br><span class="line">sess.run(predicted_labels, feed_dict=test_feed_dict)</span><br><span class="line">            <span class="keyword">for</span> fpath, real_label,</span><br><span class="line">predicted_label <span class="keyword">in</span> zip(fpaths, labels, predicted_labels_val):</span><br><span class="line">                real_label_name =</span><br><span class="line">label_name_dict[real_label]</span><br><span class="line">                predicted_label_name</span><br><span class="line">= label_name_dict[predicted_label]</span><br><span class="line">                print(<span class="string">"&#123;&#125;\t&#123;&#125;</span></span><br><span class="line"><span class="string">=&gt; &#123;&#125;"</span>.format(fpath, real_label_name, predicted_label_name))</span><br><span class="line">            <span class="comment">#rate of correct</span></span><br><span class="line">            correct_number = <span class="number">0</span></span><br><span class="line">            <span class="comment"># 计算正确率</span></span><br><span class="line">            <span class="keyword">for</span> fpath, real_label,</span><br><span class="line">predicted_label <span class="keyword">in</span> zip(fpaths, labels, predicted_labels_val):</span><br><span class="line">                <span class="keyword">if</span> real_label ==</span><br><span class="line">predicted_label:</span><br><span class="line">                    correct_number</span><br><span class="line">+= <span class="number">1</span>       </span><br><span class="line">print(<span class="string">"correct_number &#123;&#125;"</span>.format(correct_number))</span><br><span class="line">            print(<span class="string">"picknumber</span></span><br><span class="line"><span class="string">&#123;&#125;"</span>.format(picknumber))</span><br><span class="line">            correct_rate =</span><br><span class="line">correct_number*<span class="number">100</span>/picknumber</span><br><span class="line">            print(<span class="string">'正确率: &#123;&#125;.00 %'</span>.format(correct_rate))</span><br><span class="line">            x.append(step)</span><br><span class="line">            y.append(correct_rate)</span><br><span class="line">            correct_average =</span><br><span class="line">correct_average+correct_rate</span><br><span class="line">            shutil.rmtree(tarDir)</span><br><span class="line">        correct_average =</span><br><span class="line">correct_average/<span class="number">100</span></span><br><span class="line">        print(<span class="string">'correct_average: &#123;&#125;.00</span></span><br><span class="line"><span class="string">%'</span>.format(correct_average)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20200513082323540.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="正确率"></p>
<h2 id="预测模型"><a href="#预测模型" class="headerlink" title="预测模型"></a>预测模型</h2><p>在完成前面的模型参数的优化之后，利用前面训练好的网络模型和参数进行对位置图片的测试。<br><img src="https://img-blog.csdnimg.cn/20200513082614237.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQ2MTYwOA==,size_16,color_FFFFFF,t_70#pic_center" alt="预测模型"></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/05/12/Markdown%E8%AF%AD%E6%B3%95%E6%80%BB%E7%BB%93/" rel="prev" title="Markdown语法总结">
      <i class="fa fa-chevron-left"></i> Markdown语法总结
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/05/13/%E6%B5%8B%E8%AF%95%E7%9F%A5%E8%AF%86/" rel="next" title="测试知识">
      测试知识 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#技术路线"><span class="nav-number">1.</span> <span class="nav-text">技术路线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运行环境"><span class="nav-number">2.</span> <span class="nav-text">运行环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统总体结构"><span class="nav-number">3.</span> <span class="nav-text">系统总体结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据增强"><span class="nav-number">4.</span> <span class="nav-text">数据增强</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图片标注"><span class="nav-number">5.</span> <span class="nav-text">图片标注</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#训练模型"><span class="nav-number">6.</span> <span class="nav-text">训练模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试模型"><span class="nav-number">7.</span> <span class="nav-text">测试模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#预测模型"><span class="nav-number">8.</span> <span class="nav-text">预测模型</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zyx</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zyx</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
